<!DOCTYPE html>
<html>
<head>
    <title>CoinDCX Live EMA(5,10) Spot Trader</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f6fbfd; }
        #box { background: #fff; max-width: 600px; margin: 40px auto; border-radius: 10px; box-shadow: 0 2px 8px #ddd; padding: 24px; }
        .btn { border: none; background: #009; color: #fff; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 8px;}
        .btn:disabled { background: #888; }
        h3 { margin-top: 24px;}
        .log { font-size: 13px; background: #f7f7fc; border-radius: 4px; padding: 8px 12px; margin-bottom: 6px;}
        .small { color: #666; font-size: 11px;}
    </style>
</head>
<body>
<div id="box">
    <h2>CoinDCX EMA(5,10) Spot Live Auto-Trader</h2>
    <button id="start" class="btn">START</button>
    <button id="stop" class="btn">STOP</button>
    <div style="margin:12px 0;">
        <b>Status:</b> <span id="status">Idle</span>
    </div>
    <h3>Trades</h3>
    <div id="trades"></div>
    <h3>Recent Scans</h3>
    <div id="scans"></div>
    <h3>Last Candle per Pair</h3>
    <div id="candles"></div>
</div>
<script>
function refresh() {
    fetch("/status").then(x => x.json()).then(data => {
        document.getElementById("status").innerText = data.status;
        // Trades
        let tlog = data.trades.map(tr =>
            `<div class="log"><b>${tr.side}</b> <b>${tr.pair}</b> at ${tr.price} <span class="small">[${tr.time}]</span> <br/>${tr.msg}</div>`
        ).join("");
        document.getElementById("trades").innerHTML = tlog || "<span class='small'>No trades yet.</span>";
        // Scans
        let slog = data.scans.map(s =>
            `<div class="log"><b>${s.pair}</b>: ${s.price} <span class="small">[${s.time}]</span></div>`
        ).join("");
        document.getElementById("scans").innerHTML = slog || "<span class='small'>No scans yet.</span>";
        // Candles
        let clog = "";
        for (const [p, arr] of Object.entries(data.candles)) {
            for (const c of arr) {
                if (!c) continue;
                clog += `<div class="log"><b>${p}</b> | O:${c.open} H:${c.high} L:${c.low} C:${c.close} <span class="small">[${new Date(c.timestamp*1000).toLocaleTimeString()}]</span></div>`;
            }
        }
        document.getElementById("candles").innerHTML = clog || "<span class='small'>No candles yet.</span>";
    });
}
setInterval(refresh, 3000);
refresh();

document.getElementById("start").onclick = () => fetch("/start", {method: "POST"}).then(refresh);
document.getElementById("stop").onclick = () => fetch("/stop", {method: "POST"}).then(refresh);
</script>
</body>
</html>
