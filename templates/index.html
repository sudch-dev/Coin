<!DOCTYPE html>
<html>
<head>
<title>Institutional Trading Terminal</title>
<style>
body{font-family:Arial;background:#020617;color:#e5e7eb;padding:20px}
h2{margin-bottom:10px}
button{padding:10px 16px;margin:4px;font-size:14px;border-radius:4px;border:none;cursor:pointer}
.toggle{border:1px solid #334155;color:white}
.live{background:#7f1d1d}
.paper{background:#064e3b}
.start{background:#1d4ed8}
.stop{background:#475569}
.kill{background:#7c2d12}
.flatten{background:#991b1b}
.panel{background:#020617;border:1px solid #1e293b;padding:12px;margin-top:12px;border-radius:6px}
pre{max-height:220px;overflow:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #1e293b;padding:6px;text-align:center}
th{background:#0f172a}
.ctrl-label{font-weight:bold;color:#cbd5f5}
.status-ok{color:#22c55e}
.status-bad{color:#ef4444}
.status-warn{color:#eab308}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
</style>
</head>

<body>

<h2>üè¶ Institutional Autonomous Trading Terminal</h2>

<!-- ================= CONTROLLER ================= -->
<div class="panel">
<h3>üéõÔ∏è System Controller</h3>

<table style="width:100%">
<tr>
<td class="ctrl-label">Engine</td>
<td>
<button class="start" onclick="start()">‚ñ∂ Start</button>
<button class="stop" onclick="stop()">‚èπ Stop</button>
<button class="kill" onclick="kill()">üõë Kill Switch</button>
<button class="flatten" onclick="flatten()">üî• Emergency Flatten</button>
</td>
</tr>

<tr>
<td class="ctrl-label">Deployment</td>
<td>
<button class="toggle paper" onclick="setMode('PAPER')">üß™ Paper</button>
<button class="toggle live" onclick="setMode('LIVE')">üöÄ Live</button>
</td>
</tr>

<tr><td class="ctrl-label">System State</td><td id="sys_state">--</td></tr>
<tr><td class="ctrl-label">Trade Mode</td><td id="trade_mode">--</td></tr>
<tr><td class="ctrl-label">API Health</td><td id="api_health">--</td></tr>
<tr><td class="ctrl-label">Exchange Health</td><td id="ex_health">--</td></tr>
</table>
</div>

<div class="grid">

<!-- ================= STATUS ================= -->
<div class="panel">
<h3>System Status</h3>
<pre id="status"></pre>
</div>

<!-- ================= RISK ================= -->
<div class="panel">
<h3>Risk Engine</h3>
<pre id="risk"></pre>
</div>

</div>

<!-- ================= POSITIONS ================= -->
<div class="panel">
<h3>Open Positions</h3>
<table id="positions">
<tr>
<th>Pair</th><th>Entry</th><th>Qty</th><th>SL</th><th>TP</th><th>Peak</th>
</tr>
</table>
</div>

<!-- ================= ORDERS ================= -->
<div class="panel">
<h3>Orders & Executions</h3>
<table id="orders">
<tr>
<th>Time</th><th>Pair</th><th>Side</th><th>Qty</th>
<th>Price</th><th>Mode</th><th>Order ID</th><th>Status</th>
</tr>
</table>
</div>

<!-- ================= LOGS ================= -->
<div class="panel">
<h3>System Logs</h3>
<pre id="logs"></pre>
</div>

<script>
function start(){ fetch('/start',{method:'POST'}); }
function stop(){ fetch('/stop',{method:'POST'}); }
function kill(){ fetch('/kill',{method:'POST'}); }
function flatten(){ fetch('/flatten',{method:'POST'}); }

function setMode(mode){
    fetch('/set_mode',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({mode:mode})
    });
}

function refresh(){
fetch('/status').then(r=>r.json()).then(d=>{

    // Controller
    document.getElementById("sys_state").innerText=d.status;
    document.getElementById("trade_mode").innerText=d.mode;
    document.getElementById("api_health").innerText=d.health.api;
    document.getElementById("ex_health").innerText=d.health.exchange;

    setColor("api_health",d.health.api);
    setColor("ex_health",d.health.exchange);
    setStateColor("sys_state",d.status);

    // Status
    document.getElementById("status").innerText=
    JSON.stringify({
        status:d.status,
        mode:d.mode,
        last:d.last,
        balances:d.balances,
        health:d.health
    },null,2);

    // Risk
    document.getElementById("risk").innerText=
    JSON.stringify(d.risk,null,2);

    // Positions
    let ptable=`<tr>
    <th>Pair</th><th>Entry</th><th>Qty</th><th>SL</th><th>TP</th><th>Peak</th>
    </tr>`;
    for(let k in d.positions){
        let p=d.positions[k];
        ptable+=`<tr>
        <td>${k}</td>
        <td>${p.entry}</td>
        <td>${p.qty}</td>
        <td>${p.sl}</td>
        <td>${p.tp}</td>
        <td>${p.peak}</td>
        </tr>`;
    }
    document.getElementById("positions").innerHTML=ptable;

    // Orders
    let otable=`<tr>
    <th>Time</th><th>Pair</th><th>Side</th><th>Qty</th>
    <th>Price</th><th>Mode</th><th>Order ID</th><th>Status</th>
    </tr>`;
    (d.orders||[]).slice(-50).forEach(o=>{
        otable+=`<tr>
        <td>${o.time}</td>
        <td>${o.pair}</td>
        <td>${o.side}</td>
        <td>${o.qty}</td>
        <td>${o.price}</td>
        <td>${o.mode}</td>
        <td>${o.order_id||"--"}</td>
        <td>${o.status}</td>
        </tr>`;
    });
    document.getElementById("orders").innerHTML=otable;

    // Logs
    document.getElementById("logs").innerText=
        (d.logs||[]).slice(-80).join("\n");
});
}

function setColor(id,val){
    let el=document.getElementById(id);
    if(val=="OK") el.className="status-ok";
    else if(val=="ERROR") el.className="status-bad";
    else el.className="status-warn";
}

function setStateColor(id,val){
    let el=document.getElementById(id);
    if(val=="Running") el.className="status-ok";
    else if(val=="Stopped") el.className="status-bad";
    else el.className="status-warn";
}

setInterval(refresh,2000);
</script>

</body>
</html>