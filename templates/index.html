<!DOCTYPE html>
<html>
<head>
    <title>CoinDCX Lux Algo SMC OB Trader</title>
    <script>
        async function fetchOB() {
            let coin = document.getElementById("coin").value;
            let res = await fetch("/api/ob_predict", {
                method: "POST",
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({symbol: coin})
            });
            let data = await res.json();
            document.getElementById("obout").innerHTML =
              `<b>Trend:</b> ${data.trend}<br>
               <b>Reason:</b> ${data.reason}<br>
               <b>Price:</b> â‚¹${data.price} <br>
               <b>Time:</b> ${data.time}`;
        }
        async function fetchBalance() {
            let res = await fetch("/api/balance", {method: "POST"});
            let data = await res.json();
            let html = "";
            for (const [k, v] of Object.entries(data)) {
                html += `${k}: ${v} <br>`;
            }
            document.getElementById("bal").innerHTML = html;
        }
        window.onload = function() {
            fetchOB(); fetchBalance();
            setInterval(fetchOB, 30000);
            setInterval(fetchBalance, 60000);
        }
    </script>
</head>
<body>
    <h2>CoinDCX Lux Algo SMC OB Trader</h2>
    <label>Coin: </label>
    <select id="coin" onchange="fetchOB()">
        {% for coin in coins %}
        <option value="{{ coin }}">{{ coin }}</option>
        {% endfor %}
    </select>
    <button onclick="fetchOB()">Refresh</button>
    <div id="obout" style="margin-top:15px; margin-bottom:15px;"></div>
    <h4>Your Balances</h4>
    <div id="bal" style="margin-bottom:15px;"></div>
    <hr>
    <form action="#" method="POST" onsubmit="return false;">
        <b>BUY/SELL DEMO (logic to be added):</b><br>
        Amount: <input type="number" step="0.0001" min="0.0001"><br>
        Target: <input type="number"><br>
        Stop Loss: <input type="number"><br>
        <button disabled>Buy</button>
        <button disabled>Sell</button>
        <span style="color:gray;">(demo; enable and wire logic as needed)</span>
    </form>
</body>
</html>
