<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Institutional Breakout Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b0f14;
  --panel:#0f1720;
  --border:#1f2a36;
  --green:#00ff9c;
  --red:#ff4d4d;
  --blue:#3ab4ff;
  --text:#dbe4ee;
  --muted:#7f8fa3;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family: "Inter", "Segoe UI", system-ui, sans-serif;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 24px;
  background:#070b10;
  border-bottom:1px solid var(--border);
}

.title{
  font-size:18px;
  font-weight:600;
  letter-spacing:0.5px;
}

.status{
  display:flex;
  gap:15px;
  align-items:center;
}

.badge{
  padding:6px 12px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
}

.live{background:rgba(255,77,77,0.15);color:var(--red)}
.paper{background:rgba(0,255,156,0.15);color:var(--green)}
.running{background:rgba(58,180,255,0.15);color:var(--blue)}

.container{
  padding:20px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:20px;
}

.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  padding:15px;
}

.panel h3{
  margin:0 0 10px 0;
  font-size:14px;
  color:#9fb3c8;
  font-weight:600;
  letter-spacing:0.5px;
}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.btn{
  padding:10px 16px;
  border-radius:6px;
  background:#0b1220;
  border:1px solid var(--border);
  color:var(--text);
  cursor:pointer;
  font-weight:600;
}

.btn:hover{border-color:var(--blue)}

.btn-live{color:var(--red);border-color:rgba(255,77,77,0.4)}
.btn-paper{color:var(--green);border-color:rgba(0,255,156,0.4)}
.btn-start{color:var(--green)}
.btn-stop{color:var(--red)}

.table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

.table th{
  text-align:left;
  color:#8fa6bf;
  font-weight:600;
  padding:8px;
  border-bottom:1px solid var(--border);
}

.table td{
  padding:8px;
  border-bottom:1px solid #131c26;
}

.green{color:var(--green)}
.red{color:var(--red)}
.blue{color:var(--blue)}

.full{
  grid-column:1/3;
}

.footer{
  text-align:center;
  padding:10px;
  color:var(--muted);
  font-size:11px;
}

@media(max-width:900px){
  .container{grid-template-columns:1fr}
  .full{grid-column:1/2}
}
</style>
</head>

<body>

<div class="header">
  <div class="title">Institutional Breakout Engine</div>
  <div class="status">
    <div id="modeBadge" class="badge paper">PAPER</div>
    <div id="runBadge" class="badge running">RUNNING</div>
  </div>
</div>

<div class="container">

  <!-- CONTROL PANEL -->
  <div class="panel">
    <h3>Engine Control</h3>
    <div class="controls">
      <button class="btn btn-paper" onclick="setMode('PAPER')">Paper Mode</button>
      <button class="btn btn-live" onclick="setMode('LIVE')">Live Mode</button>
      <button class="btn btn-start" onclick="toggle(true)">Start Engine</button>
      <button class="btn btn-stop" onclick="toggle(false)">Stop Engine</button>
    </div>
  </div>

  <!-- SYSTEM STATUS -->
  <div class="panel">
    <h3>System Status</h3>
    <pre id="sys" style="font-size:12px;color:#9fb3c8"></pre>
  </div>

  <!-- POSITIONS -->
  <div class="panel full">
    <h3>Open Positions</h3>
    <table class="table" id="posTable">
      <thead>
        <tr>
          <th>Pair</th>
          <th>Side</th>
          <th>Qty</th>
          <th>Entry</th>
          <th>TP</th>
          <th>SL</th>
          <th>Mode</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ORDERS -->
  <div class="panel full">
    <h3>Orders / Executions</h3>
    <table class="table" id="ordTable">
      <thead>
        <tr>
          <th>Pair</th>
          <th>Side</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Mode</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<div class="footer">
  Engine: Institutional Breakout System • Live Market Execution • Risk Managed
</div>

<script>
async function load(){
  const r = await fetch('/status');
  const d = await r.json();

  // Badges
  const modeBadge = document.getElementById("modeBadge");
  modeBadge.innerText = d.mode;
  modeBadge.className = "badge " + (d.mode==="LIVE"?"live":"paper");

  // System
  document.getElementById("sys").innerText = JSON.stringify({
    mode:d.mode,
    open_positions:Object.keys(d.positions).length,
    orders:d.orders.length
  },null,2);

  // Positions
  const pt = document.querySelector("#posTable tbody");
  pt.innerHTML="";
  Object.values(d.positions).forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.pair}</td>
      <td class="${p.side==='BUY'?'green':'red'}">${p.side}</td>
      <td>${p.qty}</td>
      <td>${p.entry.toFixed(4)}</td>
      <td class="green">${p.tp.toFixed(4)}</td>
      <td class="red">${p.sl.toFixed(4)}</td>
      <td>${p.mode}</td>
    `;
    pt.appendChild(tr);
  });

  // Orders
  const ot = document.querySelector("#ordTable tbody");
  ot.innerHTML="";
  d.orders.slice(-20).reverse().forEach(o=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${o.pair||"-"}</td>
      <td class="${o.side==='BUY'?'green':'red'}">${o.side||"-"}</td>
      <td>${o.qty||"-"}</td>
      <td>${o.price||"-"}</td>
      <td>${o.mode||"-"}</td>
      <td>${o.res?.status||o.res?.paper?"OK":"ERR"}</td>
    `;
    ot.appendChild(tr);
  });
}

function setMode(m){
  fetch('/mode',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:m})});
}

function toggle(v){
  fetch('/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({run:v})});
}

setInterval(load,2000);
load();
</script>

</body>
</html>