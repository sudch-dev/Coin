<!DOCTYPE html>
<html>
<head>
<title>Institutional Breakout Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#050505;
  color:#e6fff8;
  font-family: "Segoe UI", monospace;
  margin:0;
  padding:15px;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #00ffcc;
  padding-bottom:10px;
}
.title{
  font-size:20px;
  color:#00ffcc;
  font-weight:600;
}
.badge{
  padding:4px 10px;
  border-radius:4px;
  font-size:12px;
  margin-left:5px;
}
.green{background:#0a3; color:#fff;}
.red{background:#a00; color:#fff;}
.orange{background:#ff8800; color:#000;}
.panel{
  border:1px solid #00ffcc;
  border-radius:6px;
  padding:10px;
  margin-top:12px;
}
.panel-title{
  color:#00ffcc;
  font-weight:600;
  margin-bottom:6px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  font-size:13px;
}
.ctrl button{
  background:#000;
  border:1px solid #00ffcc;
  color:#00ffcc;
  padding:8px 12px;
  margin:4px;
  border-radius:4px;
}
.ctrl button:hover{
  background:#00ffcc;
  color:#000;
  cursor:pointer;
}
.table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
.table th,.table td{
  border:1px solid #00ffcc;
  padding:6px;
  text-align:center;
}
.table th{
  background:#002222;
  color:#00ffcc;
}
.pnlpos{color:#00ff00;}
.pnlneg{color:#ff4444;}
.footer{
  margin-top:10px;
  text-align:center;
  font-size:11px;
  color:#888;
}
</style>
</head>

<body>

<div class="header">
  <div class="title">Institutional Breakout Engine</div>
  <div>
    <span id="modeBadge" class="badge orange">MODE</span>
    <span id="runBadge" class="badge red">STOPPED</span>
  </div>
</div>

<div class="panel ctrl">
  <button onclick="setMode('PAPER')">Paper</button>
  <button onclick="setMode('LIVE')">Live</button>
  <button onclick="toggle(true)">Start</button>
  <button onclick="toggle(false)">Stop</button>
</div>

<div class="panel">
  <div class="panel-title">System Status</div>
  <div class="grid" id="sys"></div>
</div>

<div class="panel">
  <div class="panel-title">PnL</div>
  <div class="grid" id="pnl"></div>
</div>

<div class="panel">
  <div class="panel-title">Open Positions</div>
  <table class="table" id="posTable">
    <thead>
      <tr>
        <th>Pair</th><th>Side</th><th>Qty</th><th>Entry</th><th>TP</th><th>SL</th><th>Mode</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="panel">
  <div class="panel-title">Orders / Exchange Confirmations</div>
  <table class="table" id="ordTable">
    <thead>
      <tr>
        <th>Time</th><th>Pair</th><th>Side</th><th>Qty</th><th>Price</th><th>Status</th><th>Mode</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="footer">
Institutional Execution Engine · Live Risk Managed · Exchange Connected
</div>

<script>
function fmt(t){
  if(!t) return "--";
  return new Date(t*1000).toLocaleTimeString();
}

function load(){
 fetch('/status').then(r=>r.json()).then(d=>{

  // Badges
  document.getElementById("modeBadge").innerText = d.mode;
  document.getElementById("modeBadge").className = "badge " + (d.mode=="LIVE"?"green":"orange");

  document.getElementById("runBadge").innerText = d.state.running ? "RUNNING" : "STOPPED";
  document.getElementById("runBadge").className = "badge " + (d.state.running?"green":"red");

  // System
  document.getElementById("sys").innerHTML = `
    <div>Server Time</div><div>${fmt(d.state.server_time)}</div>
    <div>Heartbeat</div><div>${fmt(d.state.heartbeat)}</div>
    <div>Last Scan</div><div>${fmt(d.state.last_scan)}</div>
    <div>KeepAlive</div><div>${fmt(d.state.last_keepalive)}</div>
  `;

  // PnL
  let r = d.state.pnl.realized;
  let u = d.state.pnl.unrealized;
  document.getElementById("pnl").innerHTML = `
    <div>Realized</div><div class="${r>=0?'pnlpos':'pnlneg'}">${r.toFixed(4)}</div>
    <div>Unrealized</div><div class="${u>=0?'pnlpos':'pnlneg'}">${u.toFixed(4)}</div>
  `;

  // Positions
  let pb = "";
  for(let k in d.positions){
    let p = d.positions[k];
    pb += `<tr>
      <td>${p.pair}</td>
      <td>${p.side}</td>
      <td>${p.qty}</td>
      <td>${p.entry.toFixed(4)}</td>
      <td>${p.tp.toFixed(4)}</td>
      <td>${p.sl.toFixed(4)}</td>
      <td>${p.mode}</td>
    </tr>`;
  }
  document.querySelector("#posTable tbody").innerHTML = pb || "<tr><td colspan='7'>No open positions</td></tr>";

  // Orders
  let ob = "";
  d.orders.forEach(o=>{
    ob += `<tr>
      <td>${fmt(o.time)}</td>
      <td>${o.pair||'-'}</td>
      <td>${o.side||'-'}</td>
      <td>${o.qty||'-'}</td>
      <td>${o.price||o.exit_price||'-'}</td>
      <td>${o.res?.status||o.res?.message||'ok'}</td>
      <td>${o.mode||'-'}</td>
    </tr>`;
  });
  document.querySelector("#ordTable tbody").innerHTML = ob || "<tr><td colspan='7'>No orders</td></tr>";

 });
}

function setMode(m){
 fetch('/mode',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:m})})
}

function toggle(v){
 fetch('/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({run:v})})
}

setInterval(load,2000);
</script>

</body>
</html>