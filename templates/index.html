<!DOCTYPE html>
<html>
<head>
  <title>CoinDCX Strategy</title>
</head>
<body>
  <h2>CoinDCX Trading App</h2>
  <label>Select Coin:
    <select id="coin">
      <option value="BTCINR">BTCINR</option>
      <option value="ETHINR">ETHINR</option>
    </select>
  </label>
  <br/><br/>
  <button onclick="initToken()">ğŸ” Init Token</button>
  <button onclick="fetchData()">ğŸ“ˆ Fetch Data</button>
  <p id="info"></p>

  <h3>Strategy</h3>
  Hold Amount: <input id="hold" /> <br/>
  Target Price: <input id="target" /> <br/>
  Stop Loss: <input id="sl" /> <br/>
  <button onclick="buy()">Buy Strategy</button>
  <button onclick="sell()">Sell Strategy</button>

<script>
function initToken() {
  fetch("/api/init", {method: "POST"})
    .then(r => r.json()).then(d => alert("Token: " + (d.token || d.error)))
}

function fetchData() {
  const coin = document.getElementById("coin").value;
  fetch(`/api/fetch?coin=${coin}`)
    .then(r => r.json()).then(d => {
      document.getElementById("info").innerText = `
        Price: â‚¹${d.price}, Trend: ${d.trend}, Time: ${d.timestamp}
        INR: â‚¹${d.inr}, ${coin.replace("INR","")}: ${d.coin_balance}
      `;
    });
}

function buy() {
  fetch("/api/buy-strategy", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      coin: document.getElementById("coin").value,
      hold: document.getElementById("hold").value,
      target: document.getElementById("target").value,
      sl: document.getElementById("sl").value
    })
  }).then(r => r.json()).then(d => alert(d.status));
}

function sell() {
  fetch("/api/sell-strategy", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      coin: document.getElementById("coin").value,
      hold: document.getElementById("hold").value,
      target: document.getElementById("target").value,
      sl: document.getElementById("sl").value
    })
  }).then(r => r.json()).then(d => alert(d.status));
}
</script>
</body>
</html>
